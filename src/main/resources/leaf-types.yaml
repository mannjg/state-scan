# State-Scan Leaf Types Configuration
# This file defines the types and annotations that indicate stateful components.

# Annotations that mark a class as singleton-scoped (CRITICAL for state analysis)
singletonAnnotations:
  # Javax/Jakarta Inject
  - "javax.inject.Singleton"
  - "jakarta.inject.Singleton"

  # Guice-specific
  - "com.google.inject.Singleton"

  # CDI/Quarkus
  - "jakarta.enterprise.context.ApplicationScoped"
  - "javax.enterprise.context.ApplicationScoped"

# Session-scoped annotations (CRITICAL - requires session affinity)
sessionAnnotations:
  - "javax.enterprise.context.SessionScoped"
  - "jakarta.enterprise.context.SessionScoped"
  - "com.google.inject.servlet.SessionScoped"

# Request-scoped annotations (generally safe)
requestAnnotations:
  - "javax.enterprise.context.RequestScoped"
  - "jakarta.enterprise.context.RequestScoped"
  - "com.google.inject.servlet.RequestScoped"

# Types that indicate external state dependencies
externalStateTypes:
  # JDBC/Database
  - "java.sql.DataSource"
  - "java.sql.Connection"
  - "javax.sql.DataSource"

  # JPA/Persistence
  - "javax.persistence.EntityManager"
  - "javax.persistence.EntityManagerFactory"
  - "jakarta.persistence.EntityManager"
  - "jakarta.persistence.EntityManagerFactory"

  # Hibernate
  - "org.hibernate.Session"
  - "org.hibernate.SessionFactory"

  # Messaging - Kafka
  - "org.apache.kafka.clients.producer.Producer"
  - "org.apache.kafka.clients.producer.KafkaProducer"
  - "org.apache.kafka.clients.consumer.Consumer"
  - "org.apache.kafka.clients.consumer.KafkaConsumer"

  # Messaging - JMS
  - "javax.jms.Connection"
  - "javax.jms.Session"
  - "javax.jms.MessageProducer"
  - "javax.jms.MessageConsumer"
  - "jakarta.jms.Connection"
  - "jakarta.jms.Session"

  # Messaging - RabbitMQ
  - "com.rabbitmq.client.Connection"
  - "com.rabbitmq.client.Channel"

# HTTP/REST Client types (external service dependencies)
serviceClientTypes:
  # JAX-RS Client
  - "javax.ws.rs.client.Client"
  - "javax.ws.rs.client.WebTarget"
  - "jakarta.ws.rs.client.Client"
  - "jakarta.ws.rs.client.WebTarget"

  # Apache HttpClient
  - "org.apache.http.client.HttpClient"
  - "org.apache.http.impl.client.CloseableHttpClient"
  - "org.apache.hc.client5.http.classic.HttpClient"

  # OkHttp
  - "okhttp3.OkHttpClient"
  - "okhttp3.Call"

  # Java 11+ HttpClient
  - "java.net.http.HttpClient"

  # Feign
  - "feign.Client"
  - "feign.Feign"

  # Retrofit
  - "retrofit2.Retrofit"
  - "retrofit2.Call"

# gRPC types
grpcTypes:
  - "io.grpc.ManagedChannel"
  - "io.grpc.Channel"
  - "io.grpc.Server"
  - "io.grpc.stub.AbstractStub"

# Resilience/Circuit breaker state (HIGH risk - state not shared across replicas)
resilienceTypes:
  # Resilience4j
  - "io.github.resilience4j.circuitbreaker.CircuitBreaker"
  - "io.github.resilience4j.retry.Retry"
  - "io.github.resilience4j.bulkhead.Bulkhead"
  - "io.github.resilience4j.ratelimiter.RateLimiter"
  - "io.github.resilience4j.cache.Cache"

  # Netflix Hystrix (legacy)
  - "com.netflix.hystrix.HystrixCommand"
  - "com.netflix.hystrix.HystrixCircuitBreaker"

# In-memory cache types (CRITICAL - state not shared)
cacheTypes:
  # Guava
  - "com.google.common.cache.Cache"
  - "com.google.common.cache.LoadingCache"
  # Shaded Guava (Pulsar and other projects relocate guava)
  - "org.apache.pulsar.shade.com.google.common.cache.Cache"
  - "org.apache.pulsar.shade.com.google.common.cache.LoadingCache"

  # Caffeine
  - "com.github.benmanes.caffeine.cache.Cache"
  - "com.github.benmanes.caffeine.cache.LoadingCache"
  - "com.github.benmanes.caffeine.cache.AsyncCache"

  # Ehcache (local mode)
  - "net.sf.ehcache.Cache"
  - "net.sf.ehcache.Ehcache"
  - "org.ehcache.Cache"

  # Spring Cache (local)
  - "org.springframework.cache.Cache"
  - "org.springframework.cache.CacheManager"

# REST endpoint annotations (for tracing which endpoints access stateful components)
endpointAnnotations:
  # JAX-RS
  - "javax.ws.rs.Path"
  - "javax.ws.rs.GET"
  - "javax.ws.rs.POST"
  - "javax.ws.rs.PUT"
  - "javax.ws.rs.DELETE"
  - "javax.ws.rs.PATCH"
  - "jakarta.ws.rs.Path"
  - "jakarta.ws.rs.GET"
  - "jakarta.ws.rs.POST"
  - "jakarta.ws.rs.PUT"
  - "jakarta.ws.rs.DELETE"
  - "jakarta.ws.rs.PATCH"

  # MicroProfile REST Client
  - "org.eclipse.microprofile.rest.client.inject.RestClient"
  - "org.eclipse.microprofile.rest.client.inject.RegisterRestClient"

# Mutable collection types (for field analysis within singletons)
mutableCollectionTypes:
  # Core collections
  - "java.util.Map"
  - "java.util.HashMap"
  - "java.util.LinkedHashMap"
  - "java.util.TreeMap"
  - "java.util.List"
  - "java.util.ArrayList"
  - "java.util.LinkedList"
  - "java.util.Set"
  - "java.util.HashSet"
  - "java.util.LinkedHashSet"
  - "java.util.TreeSet"
  - "java.util.Queue"
  - "java.util.Deque"

  # Concurrent collections
  - "java.util.concurrent.ConcurrentHashMap"
  - "java.util.concurrent.ConcurrentLinkedQueue"
  - "java.util.concurrent.ConcurrentLinkedDeque"
  - "java.util.concurrent.CopyOnWriteArrayList"
  - "java.util.concurrent.CopyOnWriteArraySet"
  - "java.util.concurrent.BlockingQueue"
  - "java.util.concurrent.LinkedBlockingQueue"
  - "java.util.concurrent.ArrayBlockingQueue"

  # Atomic types
  - "java.util.concurrent.atomic.AtomicReference"
  - "java.util.concurrent.atomic.AtomicInteger"
  - "java.util.concurrent.atomic.AtomicLong"
  - "java.util.concurrent.atomic.AtomicBoolean"

  # Prometheus/Micrometer metrics (accumulate state across requests)
  - "io.prometheus.client.Counter"
  - "io.prometheus.client.Gauge"
  - "io.prometheus.client.Histogram"
  - "io.prometheus.client.Summary"
  - "io.micrometer.core.instrument.Counter"
  - "io.micrometer.core.instrument.Gauge"
  - "io.micrometer.core.instrument.Timer"
  - "io.micrometer.core.instrument.DistributionSummary"

  # HdrHistogram (high-performance histograms)
  - "org.HdrHistogram.Histogram"
  - "org.HdrHistogram.Recorder"
  - "org.HdrHistogram.ConcurrentHistogram"

# Guice module types - NOT leaf nodes, but sources of binding metadata
# These are analyzed to discover bindings, not reported as findings
moduleTypes:
  - "com.google.inject.AbstractModule"
  - "com.google.inject.Module"
  - "com.google.inject.PrivateModule"
  - "com.google.inject.servlet.ServletModule"

# ThreadLocal types (HIGH risk - thread affinity issues)
threadLocalTypes:
  - "java.lang.ThreadLocal"
  - "java.lang.InheritableThreadLocal"
  - "io.netty.util.concurrent.FastThreadLocal"
  # Shaded Netty (Pulsar and other projects relocate netty)
  - "org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocal"

# File I/O types that may indicate local state persistence
fileStateTypes:
  - "java.io.FileOutputStream"
  - "java.io.FileWriter"
  - "java.io.RandomAccessFile"
  - "java.nio.channels.FileChannel"
  - "java.nio.file.Files"

# Safe types to ignore (won't flag as mutable state)
safeTypes:
  # Loggers
  - "org.slf4j.Logger"
  - "org.apache.logging.log4j.Logger"
  - "java.util.logging.Logger"

  # Immutable collections
  - "java.util.Collections.UnmodifiableMap"
  - "java.util.Collections.UnmodifiableList"
  - "java.util.Collections.UnmodifiableSet"
  - "com.google.common.collect.ImmutableMap"
  - "com.google.common.collect.ImmutableList"
  - "com.google.common.collect.ImmutableSet"

  # Configuration
  - "java.util.Properties"  # When final, usually safe

  # AtomicFieldUpdater types - lock-free concurrency primitives, not mutable state
  - "java.util.concurrent.atomic.AtomicIntegerFieldUpdater"
  - "java.util.concurrent.atomic.AtomicLongFieldUpdater"
  - "java.util.concurrent.atomic.AtomicReferenceFieldUpdater"

  # Protobuf internal types - immutable schema/descriptor objects
  - "com.google.protobuf.Internal$EnumLiteMap"
  - "com.google.protobuf.Descriptors$FileDescriptor"
  - "com.google.protobuf.Descriptors$Descriptor"
  - "com.google.protobuf.Descriptors$FieldDescriptor"
  - "com.google.protobuf.Descriptors$EnumDescriptor"
  - "com.google.protobuf.Descriptors$ServiceDescriptor"
  - "com.google.protobuf.Descriptors$MethodDescriptor"
  - "com.google.protobuf.MapEntry"
  - "com.google.protobuf.GeneratedMessageV3$FieldAccessorTable"
  - "com.google.protobuf.Parser"
  # Shaded protobuf (Pulsar and other projects relocate protobuf)
  - "org.apache.pulsar.shaded.com.google.protobuf.v241.Internal$EnumLiteMap"

  # Shaded Guava immutable collections
  - "org.apache.pulsar.shade.com.google.common.collect.ImmutableList"
  - "org.apache.pulsar.shade.com.google.common.collect.ImmutableMap"
  - "org.apache.pulsar.shade.com.google.common.collect.ImmutableSet"

  # Reflection method handles - immutable references
  - "java.lang.reflect.Method"

  # gRPC method descriptors - immutable service definitions
  - "io.grpc.MethodDescriptor"
  - "io.grpc.ServiceDescriptor"

  # Jackson ObjectMapper - thread-safe, stateless serializer
  - "com.fasterxml.jackson.databind.ObjectMapper"
  - "com.fasterxml.jackson.databind.ObjectReader"
  - "com.fasterxml.jackson.databind.ObjectWriter"

  # Compiled patterns - immutable
  - "java.util.regex.Pattern"

  # Thread-safe date/time formatters
  - "java.time.format.DateTimeFormatter"
